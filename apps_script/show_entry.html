<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input[type="text"],
      input[type="date"],
      textarea,
      select {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .checkbox-group {
        margin: 10px 0;
      }
      button {
        background-color: #3498db;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #2980b9;
      }
      .error {
        color: #e74c3c;
        margin-top: 5px;
      }
      .success {
        color: #27ae60;
        margin-top: 5px;
      }
      #bandList {
        margin-top: 10px;
      }
      .band-item {
        display: inline-block;
        background: #f0f0f0;
        padding: 5px 10px;
        margin: 2px;
        border-radius: 3px;
      }
      .band-item button {
        background: none;
        border: none;
        color: #e74c3c;
        padding: 0 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Add New Show</h1>
    <form id="showForm">
      <div class="form-group">
        <label for="date">Date:</label>
        <input type="date" id="date" required>
      </div>
      
      <div class="form-group">
        <label for="venue">Venue:</label>
        <input type="text" id="venue" list="venueList" required>
        <datalist id="venueList"></datalist>
      </div>
      
      <div class="form-group">
        <label for="event">Event (optional):</label>
        <input type="text" id="event" list="eventList">
        <datalist id="eventList"></datalist>
      </div>
      
      <div class="form-group">
        <label for="bands">Bands (comma-separated):</label>
        <input type="text" id="bands" placeholder="Enter band names separated by commas">
        <div id="bandList"></div>
      </div>
      
      <div class="checkbox-group">
        <input type="checkbox" id="confirmed" checked>
        <label for="confirmed">Show is confirmed</label>
      </div>
      
      <div class="checkbox-group">
        <input type="checkbox" id="attended" checked>
        <label for="attended">I attended this show</label>
      </div>
      
      <div class="form-group">
        <label for="notes">Notes:</label>
        <textarea id="notes" rows="3"></textarea>
      </div>
      
      <button type="submit">Add Show</button>
      <div id="message"></div>
    </form>

    <script>
      // Load venues and events when page loads
      window.onload = function() {
        loadVenues();
        loadEvents();
      };
      
      // Load venues from AppSheet
      function loadVenues() {
        google.script.run
          .withSuccessHandler(function(venues) {
            const datalist = document.getElementById('venueList');
            venues.forEach(venue => {
              const option = document.createElement('option');
              option.value = venue;
              datalist.appendChild(option);
            });
          })
          .withFailureHandler(function(error) {
            console.error('Error loading venues:', error);
          })
          .getVenues();
      }
      
      // Load events from AppSheet
      function loadEvents() {
        google.script.run
          .withSuccessHandler(function(events) {
            const datalist = document.getElementById('eventList');
            events.forEach(event => {
              const option = document.createElement('option');
              option.value = event;
              datalist.appendChild(option);
            });
          })
          .withFailureHandler(function(error) {
            console.error('Error loading events:', error);
          })
          .getEvents();
      }
      
      // Handle form submission
      document.getElementById('showForm').onsubmit = function(e) {
        e.preventDefault();
        const messageDiv = document.getElementById('message');
        messageDiv.className = '';
        messageDiv.textContent = 'Adding show...';
        
        const showData = {
          date: document.getElementById('date').value,
          venue: document.getElementById('venue').value,
          event: document.getElementById('event').value,
          bands: document.getElementById('bands').value.split(',').map(b => b.trim()).filter(b => b),
          confirmed: document.getElementById('confirmed').checked,
          attended: document.getElementById('attended').checked,
          notes: document.getElementById('notes').value
        };
        
        google.script.run
          .withSuccessHandler(function(response) {
            messageDiv.className = 'success';
            messageDiv.textContent = response.message;
            document.getElementById('showForm').reset();
          })
          .withFailureHandler(function(error) {
            messageDiv.className = 'error';
            messageDiv.textContent = 'Error: ' + error;
          })
          .addShow(showData);
      };
    </script>
  </body>
</html> 